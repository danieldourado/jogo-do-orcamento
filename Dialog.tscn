[gd_scene load_steps=7 format=2]

[ext_resource path="res://9SliceBox.tscn" type="PackedScene" id=1]
[ext_resource path="res://images/Interface/EDUCAÇÃO.png" type="Texture" id=2]
[ext_resource path="res://fonts/new_building_font.tres" type="DynamicFont" id=3]
[ext_resource path="res://YesButton.tscn" type="PackedScene" id=4]
[ext_resource path="res://NoButton.tscn" type="PackedScene" id=5]

[sub_resource type="GDScript" id=1]
script/source = "extends Control

var type 
var dialog_data
func set_dialog_type(type):
	self.type = type
	dialog_data = get_dialog_from_type(type)
	dialog_data = get_random_cost(dialog_data)
	get_node(\"9SliceBox/VBoxContainer/Label\").text = \"Decisão sobre \"+dialog_data.tipo
	get_node(\"9SliceBox/VBoxContainer/Label2\").text = dialog_data.texto
	get_node(\"9SliceBox/VBoxContainer/HBoxContainer/Label\").text = \"Custo: \"+str((int(dialog_data.sim.financeiro) * -1))

func get_random_cost(dialog_data):
	dialog_data.sim.financeiro = (Global.get_random(3)+1)*5000*-1
	return dialog_data
	
func get_dialog_from_type(type):
	var dialogs = sort_dialogs_by_type(Global.game_data.dialogs)[type]
	if dialogs.size() == 1:
		return dialogs[0]
		
	var index = Global.get_random(dialogs.size())
	var dialog = dialogs[index]
	dialogs.remove(index)
	return dialog

func sort_dialogs_by_type(dialog_data):
	var dialogs = {}
	for dialog in dialog_data:
		if dialogs.has(dialog.tipo) == false:
			dialogs[dialog.tipo] = []
		dialogs[dialog.tipo].append(dialog)
	return dialogs
	
func _on_YesButton_pressed():	
	Global.barras_de_necessidade.set_satisfacao(type, dialog_data.sim.satisfacao)
	Global.barras_de_orcamento.set_satisfacao(type, dialog_data.sim.financeiro)
	Global.barras_de_orcamento_geral.set_satisfacao(Global.OrcamentoGeral, dialog_data.sim.financeiro)
	Global.construction_menu.add_building(dialog_data.nome, dialog_data.predio)
	Global.create_generic_dialog(dialog_data.nome+\" adicionado(a)\", 
	\"Texto explicando que \"+dialog_data.nome+\" foi adicionada ao pool de construções\",dialog_data.predio, load(\"res://audios/Construção Adicionada.ogg\"))
	remove_me_from_parent()


func _on_NoButton_pressed():
	Global.barras_de_necessidade.set_satisfacao(type, dialog_data.nao.satisfacao)
	Global.barras_de_orcamento.set_satisfacao(type, dialog_data.nao.financeiro)
	
	remove_me_from_parent()

func remove_me_from_parent():
	get_parent().remove_child(get_node(\".\"))
	"

[node name="Control" type="Control"]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -204.0
margin_top = -203.5
margin_right = 204.0
margin_bottom = 203.5
rect_pivot_offset = Vector2( 310, 150 )
script = SubResource( 1 )

[node name="9SliceBox" parent="." instance=ExtResource( 1 )]
margin_left = -282.0
margin_top = -282.5
margin_right = 288.0
margin_bottom = 217.5

[node name="TextureRect2" type="TextureRect" parent="9SliceBox"]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -148.5
margin_top = -226.0
margin_right = 148.5
margin_bottom = -15.0
rect_pivot_offset = Vector2( 153.332, 48.1302 )
texture = ExtResource( 2 )
expand = true
stretch_mode = 5

[node name="VBoxContainer" type="VBoxContainer" parent="9SliceBox"]
margin_left = 78.0
margin_top = 248.0
margin_right = 483.0
margin_bottom = 464.0

[node name="Label" type="Label" parent="9SliceBox/VBoxContainer"]
margin_right = 405.0
margin_bottom = 28.0
custom_fonts/font = ExtResource( 3 )
custom_colors/font_color = Color( 0, 0, 0, 1 )
text = "Precisamos de um hospital"
align = 1

[node name="Label2" type="Label" parent="9SliceBox/VBoxContainer"]
margin_top = 32.0
margin_right = 405.0
margin_bottom = 184.0
custom_fonts/font = ExtResource( 3 )
custom_colors/font_color = Color( 0, 0, 0, 1 )
text = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam nec justo venenatis, ornare Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam nec justo venenatis, ornare "
align = 1
autowrap = true

[node name="HBoxContainer" type="HBoxContainer" parent="9SliceBox/VBoxContainer"]
margin_top = 188.0
margin_right = 405.0
margin_bottom = 248.0
alignment = 1

[node name="Label" type="Label" parent="9SliceBox/VBoxContainer/HBoxContainer"]
margin_left = 52.0
margin_top = 16.0
margin_right = 164.0
margin_bottom = 44.0
custom_fonts/font = ExtResource( 3 )
custom_colors/font_color = Color( 0, 0, 0, 1 )
text = "Custo: 5000"

[node name="YesButton" parent="9SliceBox/VBoxContainer/HBoxContainer" instance=ExtResource( 4 )]
margin_left = 168.0
margin_right = 258.0
margin_bottom = 60.0

[node name="NoButton" parent="9SliceBox/VBoxContainer/HBoxContainer" instance=ExtResource( 5 )]
margin_left = 262.0
margin_right = 352.0
margin_bottom = 60.0

[connection signal="pressed" from="9SliceBox/VBoxContainer/HBoxContainer/YesButton" to="." method="_on_YesButton_pressed"]
[connection signal="pressed" from="9SliceBox/VBoxContainer/HBoxContainer/NoButton" to="." method="_on_NoButton_pressed"]
